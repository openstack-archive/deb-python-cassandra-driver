<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Execution Profiles (experimental) &#8212; Cassandra Driver 3.10 documentation</title>
    
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3.10',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Performance Notes" href="performance.html" />
    <link rel="prev" title="Upgrading" href="upgrading.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="performance.html" title="Performance Notes"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="upgrading.html" title="Upgrading"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Cassandra Driver 3.10 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Execution Profiles (experimental)</a><ul>
<li><a class="reference internal" href="#mapping-legacy-parameters-to-profiles">Mapping Legacy Parameters to Profiles</a></li>
<li><a class="reference internal" href="#using-execution-profiles">Using Execution Profiles</a><ul>
<li><a class="reference internal" href="#default">Default</a></li>
<li><a class="reference internal" href="#initializing-cluster-with-profiles">Initializing cluster with profiles</a></li>
<li><a class="reference internal" href="#adding-named-profiles">Adding named profiles</a></li>
<li><a class="reference internal" href="#passing-a-profile-instance-without-mapping">Passing a profile instance without mapping</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="upgrading.html"
                        title="previous chapter">Upgrading</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="performance.html"
                        title="next chapter">Performance Notes</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/execution_profiles.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="execution-profiles-experimental">
<h1>Execution Profiles (experimental)<a class="headerlink" href="#execution-profiles-experimental" title="Permalink to this headline">¶</a></h1>
<p>Execution profiles are an experimental API aimed at making it easier to execute requests in different ways within
a single connected <code class="docutils literal"><span class="pre">Session</span></code>. Execution profiles are being introduced to deal with the exploding number of
configuration options, especially as the database platform evolves more complex workloads.</p>
<p>The Execution Profile API is being introduced now, in an experimental capacity, in order to take advantage of it in
existing projects, and to gauge interest and feedback in the community. For now, the legacy configuration remains
intact, but legacy and Execution Profile APIs cannot be used simultaneously on the same client <code class="docutils literal"><span class="pre">Cluster</span></code>.</p>
<p>This document explains how Execution Profiles relate to existing settings, and shows how to use the new profiles for
request execution.</p>
<div class="section" id="mapping-legacy-parameters-to-profiles">
<h2>Mapping Legacy Parameters to Profiles<a class="headerlink" href="#mapping-legacy-parameters-to-profiles" title="Permalink to this headline">¶</a></h2>
<p>Execution profiles can inherit from <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.ExecutionProfile" title="cassandra.cluster.ExecutionProfile"><code class="xref py py-class docutils literal"><span class="pre">cluster.ExecutionProfile</span></code></a>, and currently provide the following options,
previously input from the noted attributes:</p>
<ul class="simple">
<li>load_balancing_policy - <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Cluster.load_balancing_policy" title="cassandra.cluster.Cluster.load_balancing_policy"><code class="xref py py-attr docutils literal"><span class="pre">Cluster.load_balancing_policy</span></code></a></li>
<li>request_timeout - <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Session.default_timeout" title="cassandra.cluster.Session.default_timeout"><code class="xref py py-attr docutils literal"><span class="pre">Session.default_timeout</span></code></a>, optional <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Session.execute" title="cassandra.cluster.Session.execute"><code class="xref py py-meth docutils literal"><span class="pre">Session.execute()</span></code></a> parameter</li>
<li>retry_policy - <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Cluster.default_retry_policy" title="cassandra.cluster.Cluster.default_retry_policy"><code class="xref py py-attr docutils literal"><span class="pre">Cluster.default_retry_policy</span></code></a>, optional <a class="reference internal" href="api/cassandra/query.html#cassandra.query.Statement.retry_policy" title="cassandra.query.Statement.retry_policy"><code class="xref py py-attr docutils literal"><span class="pre">Statement.retry_policy</span></code></a> attribute</li>
<li>consistency_level - <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Session.default_consistency_level" title="cassandra.cluster.Session.default_consistency_level"><code class="xref py py-attr docutils literal"><span class="pre">Session.default_consistency_level</span></code></a>, optional <a class="reference internal" href="api/cassandra/query.html#cassandra.query.Statement.consistency_level" title="cassandra.query.Statement.consistency_level"><code class="xref py py-attr docutils literal"><span class="pre">Statement.consistency_level</span></code></a> attribute</li>
<li>serial_consistency_level - <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Session.default_serial_consistency_level" title="cassandra.cluster.Session.default_serial_consistency_level"><code class="xref py py-attr docutils literal"><span class="pre">Session.default_serial_consistency_level</span></code></a>, optional <a class="reference internal" href="api/cassandra/query.html#cassandra.query.Statement.serial_consistency_level" title="cassandra.query.Statement.serial_consistency_level"><code class="xref py py-attr docutils literal"><span class="pre">Statement.serial_consistency_level</span></code></a> attribute</li>
<li>row_factory - <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Session.row_factory" title="cassandra.cluster.Session.row_factory"><code class="xref py py-attr docutils literal"><span class="pre">Session.row_factory</span></code></a> attribute</li>
</ul>
<p>When using the new API, these parameters can be defined by instances of <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.ExecutionProfile" title="cassandra.cluster.ExecutionProfile"><code class="xref py py-class docutils literal"><span class="pre">cluster.ExecutionProfile</span></code></a>.</p>
</div>
<div class="section" id="using-execution-profiles">
<h2>Using Execution Profiles<a class="headerlink" href="#using-execution-profiles" title="Permalink to this headline">¶</a></h2>
<div class="section" id="default">
<h3>Default<a class="headerlink" href="#default" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cassandra.cluster</span> <span class="k">import</span> <span class="n">Cluster</span>
<span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">()</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">local_query</span> <span class="o">=</span> <span class="s1">&#39;SELECT rpc_address FROM system.local&#39;</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">cluster</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">all_hosts</span><span class="p">():</span>
    <span class="nb">print</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">local_query</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Row</span><span class="p">(</span><span class="n">rpc_address</span><span class="o">=</span><span class="s1">&#39;127.0.0.2&#39;</span><span class="p">)</span>
<span class="n">Row</span><span class="p">(</span><span class="n">rpc_address</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The default execution profile is built from Cluster parameters and default Session attributes. This profile matches existing default
parameters.</p>
</div>
<div class="section" id="initializing-cluster-with-profiles">
<h3>Initializing cluster with profiles<a class="headerlink" href="#initializing-cluster-with-profiles" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cassandra.cluster</span> <span class="k">import</span> <span class="n">ExecutionProfile</span>
<span class="kn">from</span> <span class="nn">cassandra.policies</span> <span class="k">import</span> <span class="n">WhiteListRoundRobinPolicy</span>

<span class="n">node1_profile</span> <span class="o">=</span> <span class="n">ExecutionProfile</span><span class="p">(</span><span class="n">load_balancing_policy</span><span class="o">=</span><span class="n">WhiteListRoundRobinPolicy</span><span class="p">([</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">]))</span>
<span class="n">node2_profile</span> <span class="o">=</span> <span class="n">ExecutionProfile</span><span class="p">(</span><span class="n">load_balancing_policy</span><span class="o">=</span><span class="n">WhiteListRoundRobinPolicy</span><span class="p">([</span><span class="s1">&#39;127.0.0.2&#39;</span><span class="p">]))</span>

<span class="n">profiles</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;node1&#39;</span><span class="p">:</span> <span class="n">node1_profile</span><span class="p">,</span> <span class="s1">&#39;node2&#39;</span><span class="p">:</span> <span class="n">node2_profile</span><span class="p">}</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="n">execution_profiles</span><span class="o">=</span><span class="n">profiles</span><span class="p">)</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">cluster</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">all_hosts</span><span class="p">():</span>
    <span class="nb">print</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">local_query</span><span class="p">,</span> <span class="n">execution_profile</span><span class="o">=</span><span class="s1">&#39;node1&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Row</span><span class="p">(</span><span class="n">rpc_address</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">)</span>
<span class="n">Row</span><span class="p">(</span><span class="n">rpc_address</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">cluster</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">all_hosts</span><span class="p">():</span>
    <span class="nb">print</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">local_query</span><span class="p">,</span> <span class="n">execution_profile</span><span class="o">=</span><span class="s1">&#39;node2&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Row</span><span class="p">(</span><span class="n">rpc_address</span><span class="o">=</span><span class="s1">&#39;127.0.0.2&#39;</span><span class="p">)</span>
<span class="n">Row</span><span class="p">(</span><span class="n">rpc_address</span><span class="o">=</span><span class="s1">&#39;127.0.0.2&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">cluster</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">all_hosts</span><span class="p">():</span>
    <span class="nb">print</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">local_query</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Row</span><span class="p">(</span><span class="n">rpc_address</span><span class="o">=</span><span class="s1">&#39;127.0.0.2&#39;</span><span class="p">)</span>
<span class="n">Row</span><span class="p">(</span><span class="n">rpc_address</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that, even when custom profiles are injected, the default <code class="docutils literal"><span class="pre">TokenAwarePolicy(DCAwareRoundRobinPolicy())</span></code> is still
present. To override the default, specify a policy with the <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.EXEC_PROFILE_DEFAULT" title="cassandra.cluster.EXEC_PROFILE_DEFAULT"><code class="xref py py-data docutils literal"><span class="pre">EXEC_PROFILE_DEFAULT</span></code></a> key.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cassandra.cluster</span> <span class="k">import</span> <span class="n">EXEC_PROFILE_DEFAULT</span>
<span class="n">profile</span> <span class="o">=</span> <span class="n">ExecutionProfile</span><span class="p">(</span><span class="n">request_timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="n">execution_profiles</span><span class="o">=</span><span class="p">{</span><span class="n">EXEC_PROFILE_DEFAULT</span><span class="p">:</span> <span class="n">profile</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-named-profiles">
<h3>Adding named profiles<a class="headerlink" href="#adding-named-profiles" title="Permalink to this headline">¶</a></h3>
<p>New profiles can be added constructing from scratch, or deriving from default:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">locked_execution</span> <span class="o">=</span> <span class="n">ExecutionProfile</span><span class="p">(</span><span class="n">load_balancing_policy</span><span class="o">=</span><span class="n">WhiteListRoundRobinPolicy</span><span class="p">([</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">]))</span>
<span class="n">node1_profile</span> <span class="o">=</span> <span class="s1">&#39;node1_whitelist&#39;</span>
<span class="n">cluster</span><span class="o">.</span><span class="n">add_execution_profile</span><span class="p">(</span><span class="n">node1_profile</span><span class="p">,</span> <span class="n">locked_execution</span><span class="p">)</span>

<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">cluster</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">all_hosts</span><span class="p">():</span>
    <span class="nb">print</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">local_query</span><span class="p">,</span> <span class="n">execution_profile</span><span class="o">=</span><span class="n">node1_profile</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Row</span><span class="p">(</span><span class="n">rpc_address</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">)</span>
<span class="n">Row</span><span class="p">(</span><span class="n">rpc_address</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Cluster.add_execution_profile" title="cassandra.cluster.Cluster.add_execution_profile"><code class="xref py py-meth docutils literal"><span class="pre">Cluster.add_execution_profile()</span></code></a> for details and optional parameters.</p>
</div>
<div class="section" id="passing-a-profile-instance-without-mapping">
<h3>Passing a profile instance without mapping<a class="headerlink" href="#passing-a-profile-instance-without-mapping" title="Permalink to this headline">¶</a></h3>
<p>We also have the ability to pass profile instances to be used for execution, but not added to the mapping:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cassandra.query</span> <span class="k">import</span> <span class="n">tuple_factory</span>

<span class="n">tmp</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execution_profile_clone_update</span><span class="p">(</span><span class="s1">&#39;node1&#39;</span><span class="p">,</span> <span class="n">request_timeout</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">row_factory</span><span class="o">=</span><span class="n">tuple_factory</span><span class="p">)</span>

<span class="nb">print</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">local_query</span><span class="p">,</span> <span class="n">execution_profile</span><span class="o">=</span><span class="n">tmp</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">local_query</span><span class="p">,</span> <span class="n">execution_profile</span><span class="o">=</span><span class="s1">&#39;node1&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,)</span>
<span class="n">Row</span><span class="p">(</span><span class="n">rpc_address</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The new profile is a shallow copy, so the <code class="docutils literal"><span class="pre">tmp</span></code> profile shares a load balancing policy with one managed by the cluster.
If reference objects are to be updated in the clone, one would typically set those attributes to a new instance.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="performance.html" title="Performance Notes"
             >next</a> |</li>
        <li class="right" >
          <a href="upgrading.html" title="Upgrading"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Cassandra Driver 3.10 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2013-2017 DataStax.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.3.
    </div>
  </body>
</html>