<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Upgrading &#8212; Cassandra Driver 3.10 documentation</title>
    
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3.10',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Execution Profiles (experimental)" href="execution_profiles.html" />
    <link rel="prev" title="Getting Started" href="getting_started.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="execution_profiles.html" title="Execution Profiles (experimental)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="getting_started.html" title="Getting Started"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Cassandra Driver 3.10 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Upgrading</a><ul>
<li><a class="reference internal" href="#upgrading-to-3-0">Upgrading to 3.0</a><ul>
<li><a class="reference internal" href="#default-consistency-is-now-local-one">Default consistency is now <code class="docutils literal"><span class="pre">LOCAL_ONE</span></code></a></li>
<li><a class="reference internal" href="#execution-api-updates">Execution API Updates</a><ul>
<li><a class="reference internal" href="#result-return-normalization">Result return normalization</a></li>
<li><a class="reference internal" href="#trace-information-is-not-attached-to-executed-statements">Trace information is not attached to executed Statements</a></li>
<li><a class="reference internal" href="#binding-named-parameters-now-ignores-extra-names">Binding named parameters now ignores extra names</a></li>
</ul>
</li>
<li><a class="reference internal" href="#blist-removed-as-soft-dependency">blist removed as soft dependency</a></li>
<li><a class="reference internal" href="#metadata-api-updates">Metadata API Updates</a></li>
<li><a class="reference internal" href="#several-deprecated-features-are-removed">Several deprecated features are removed</a></li>
</ul>
</li>
<li><a class="reference internal" href="#upgrading-to-2-1-from-2-0">Upgrading to 2.1 from 2.0</a><ul>
<li><a class="reference internal" href="#using-the-v3-native-protocol">Using the v3 Native Protocol</a></li>
<li><a class="reference internal" href="#working-with-user-defined-types">Working with User-Defined Types</a></li>
<li><a class="reference internal" href="#customizing-encoders-for-non-prepared-statements">Customizing Encoders for Non-prepared Statements</a></li>
<li><a class="reference internal" href="#using-client-side-protocol-level-timestamps">Using Client-Side Protocol-Level Timestamps</a></li>
</ul>
</li>
<li><a class="reference internal" href="#upgrading-to-2-0-from-1-x">Upgrading to 2.0 from 1.x</a><ul>
<li><a class="reference internal" href="#using-the-v2-native-protocol">Using the v2 Native Protocol</a></li>
<li><a class="reference internal" href="#automatic-query-paging">Automatic Query Paging</a></li>
<li><a class="reference internal" href="#protocol-level-batch-statements">Protocol-Level Batch Statements</a></li>
<li><a class="reference internal" href="#sasl-based-authentication">SASL-based Authentication</a></li>
<li><a class="reference internal" href="#lightweight-transactions">Lightweight Transactions</a></li>
<li><a class="reference internal" href="#calling-cluster-shutdown">Calling Cluster.shutdown()</a></li>
<li><a class="reference internal" href="#deprecations">Deprecations</a></li>
<li><a class="reference internal" href="#dependency-changes">Dependency Changes</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="getting_started.html"
                        title="previous chapter">Getting Started</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="execution_profiles.html"
                        title="next chapter">Execution Profiles (experimental)</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/upgrading.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="upgrading">
<h1>Upgrading<a class="headerlink" href="#upgrading" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="upgrading-to-3-0">
<h2>Upgrading to 3.0<a class="headerlink" href="#upgrading-to-3-0" title="Permalink to this headline">¶</a></h2>
<p>Version 3.0 of the DataStax Python driver for Apache Cassandra
adds support for Cassandra 3.0 while maintaining support for
previously supported versions. In addition to substantial internal rework,
there are several updates to the API that integrators will need
to consider:</p>
<div class="section" id="default-consistency-is-now-local-one">
<h3>Default consistency is now <code class="docutils literal"><span class="pre">LOCAL_ONE</span></code><a class="headerlink" href="#default-consistency-is-now-local-one" title="Permalink to this headline">¶</a></h3>
<p>Previous value was <code class="docutils literal"><span class="pre">ONE</span></code>. The new value is introduced to mesh with the default
DC-aware load balancing policy and to match other drivers.</p>
</div>
<div class="section" id="execution-api-updates">
<h3>Execution API Updates<a class="headerlink" href="#execution-api-updates" title="Permalink to this headline">¶</a></h3>
<div class="section" id="result-return-normalization">
<h4>Result return normalization<a class="headerlink" href="#result-return-normalization" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://datastax-oss.atlassian.net/browse/PYTHON-368">PYTHON-368</a></p>
<p>Previously results would be returned as a <code class="docutils literal"><span class="pre">list</span></code> of rows for result rows
up to <code class="docutils literal"><span class="pre">fetch_size</span></code>, and <code class="docutils literal"><span class="pre">PagedResult</span></code> afterward. This could break
application code that assumed one type and got another.</p>
<p>Now, all results are returned as an iterable <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.ResultSet" title="cassandra.cluster.ResultSet"><code class="xref py py-class docutils literal"><span class="pre">ResultSet</span></code></a>.</p>
<p>The preferred way to consume results of unknown size is to iterate through
them, letting automatic paging occur as they are consumed.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM system.local&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="n">process</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
<p>If the expected size of the results is known, it is still possible to
materialize a list using the iterator:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM system.local&quot;</span><span class="p">)</span>
<span class="n">row_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
<p>For backward compatability, <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.ResultSet" title="cassandra.cluster.ResultSet"><code class="xref py py-class docutils literal"><span class="pre">ResultSet</span></code></a> supports indexing. If
the result is paged, all pages will be materialized. A warning will
be logged if a paged query is implicitly materialized.</p>
</div>
<div class="section" id="trace-information-is-not-attached-to-executed-statements">
<h4>Trace information is not attached to executed Statements<a class="headerlink" href="#trace-information-is-not-attached-to-executed-statements" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://datastax-oss.atlassian.net/browse/PYTHON-318">PYTHON-318</a></p>
<p>Previously trace data was attached to Statements if tracing was enabled. This
could lead to confusion if the same statement was used for multiple executions.</p>
<p>Now, trace data is associated with the <code class="docutils literal"><span class="pre">ResponseFuture</span></code> and <code class="docutils literal"><span class="pre">ResultSet</span></code>
returned for each query:</p>
<p><a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.ResponseFuture.get_query_trace" title="cassandra.cluster.ResponseFuture.get_query_trace"><code class="xref py py-meth docutils literal"><span class="pre">ResponseFuture.get_query_trace()</span></code></a></p>
<p><a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.ResponseFuture.get_all_query_traces" title="cassandra.cluster.ResponseFuture.get_all_query_traces"><code class="xref py py-meth docutils literal"><span class="pre">ResponseFuture.get_all_query_traces()</span></code></a></p>
<p><a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.ResultSet.get_query_trace" title="cassandra.cluster.ResultSet.get_query_trace"><code class="xref py py-meth docutils literal"><span class="pre">ResultSet.get_query_trace()</span></code></a></p>
<p><a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.ResultSet.get_all_query_traces" title="cassandra.cluster.ResultSet.get_all_query_traces"><code class="xref py py-meth docutils literal"><span class="pre">ResultSet.get_all_query_traces()</span></code></a></p>
</div>
<div class="section" id="binding-named-parameters-now-ignores-extra-names">
<h4>Binding named parameters now ignores extra names<a class="headerlink" href="#binding-named-parameters-now-ignores-extra-names" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://datastax-oss.atlassian.net/browse/PYTHON-178Cassadfasdf">PYTHON-178</a></p>
<p>Previously, <a class="reference internal" href="api/cassandra/query.html#cassandra.query.BoundStatement.bind" title="cassandra.query.BoundStatement.bind"><code class="xref py py-meth docutils literal"><span class="pre">BoundStatement.bind()</span></code></a> would raise if a mapping
was passed with extra names not found in the prepared statement.</p>
<p>Behavior in 3.0+ is to ignore extra names.</p>
</div>
</div>
<div class="section" id="blist-removed-as-soft-dependency">
<h3>blist removed as soft dependency<a class="headerlink" href="#blist-removed-as-soft-dependency" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://datastax-oss.atlassian.net/browse/PYTHON-385">PYTHON-385</a></p>
<p>Previously the driver had a soft dependency on <code class="docutils literal"><span class="pre">blist</span> <span class="pre">sortedset</span></code>, using
that where available and using an internal fallback where possible.</p>
<p>Now, the driver never chooses the <code class="docutils literal"><span class="pre">blist</span></code> variant, instead returning the
internal <a class="reference internal" href="api/cassandra/util.html#cassandra.util.SortedSet" title="cassandra.util.SortedSet"><code class="xref py py-class docutils literal"><span class="pre">util.SortedSet</span></code></a> for all <code class="docutils literal"><span class="pre">set</span></code> results. The class implements
all standard set operations, so no integration code should need to change unless
it explicitly checks for <code class="docutils literal"><span class="pre">sortedset</span></code> type.</p>
</div>
<div class="section" id="metadata-api-updates">
<h3>Metadata API Updates<a class="headerlink" href="#metadata-api-updates" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://datastax-oss.atlassian.net/browse/PYTHON-276">PYTHON-276</a>, <a class="reference external" href="https://datastax-oss.atlassian.net/browse/PYTHON-408">PYTHON-408</a>, <a class="reference external" href="https://datastax-oss.atlassian.net/browse/PYTHON-400">PYTHON-400</a>, <a class="reference external" href="https://datastax-oss.atlassian.net/browse/PYTHON-422">PYTHON-422</a></p>
<p>Cassandra 3.0 brought a substantial overhaul to the internal schema metadata representation.
This version of the driver supports that metadata in addition to the legacy version. Doing so
also brought some changes to the metadata model.</p>
<p>The present API is documented: <a class="reference internal" href="api/cassandra/metadata.html#module-cassandra.metadata" title="cassandra.metadata"><code class="xref any py py-mod docutils literal"><span class="pre">cassandra.metadata</span></code></a>. Changes highlighted below:</p>
<ul class="simple">
<li>All types are now exposed as CQL types instead of types derived from the internal server implementation</li>
<li>Some metadata attributes have changed names to match current nomenclature (for example, <code class="xref py py-attr docutils literal"><span class="pre">Index.kind</span></code> in place of <code class="docutils literal"><span class="pre">Index.type</span></code>).</li>
<li>Some metadata attributes removed<ul>
<li><code class="docutils literal"><span class="pre">TableMetadata.keyspace</span></code> reference replaced with <a class="reference internal" href="api/cassandra/metadata.html#cassandra.metadata.TableMetadata.keyspace_name" title="cassandra.metadata.TableMetadata.keyspace_name"><code class="xref py py-attr docutils literal"><span class="pre">TableMetadata.keyspace_name</span></code></a></li>
<li><code class="docutils literal"><span class="pre">ColumnMetadata.index</span></code> is removed table- and keyspace-level mappings are still maintained</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="several-deprecated-features-are-removed">
<h3>Several deprecated features are removed<a class="headerlink" href="#several-deprecated-features-are-removed" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://datastax-oss.atlassian.net/browse/PYTHON-292">PYTHON-292</a></p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">ResponseFuture.result</span></code> timeout parameter is removed, use <code class="docutils literal"><span class="pre">Session.execute</span></code> timeout instead (<a class="reference external" href="https://github.com/datastax/python-driver/commit/031ebb0">031ebb0</a>)</li>
<li><code class="docutils literal"><span class="pre">Cluster.refresh_schema</span></code> removed, use <code class="docutils literal"><span class="pre">Cluster.refresh_*_metadata</span></code> instead (<a class="reference external" href="https://github.com/datastax/python-driver/commit/419fcdf">419fcdf</a>)</li>
<li><code class="docutils literal"><span class="pre">Cluster.submit_schema_refresh</span></code> removed (<a class="reference external" href="https://github.com/datastax/python-driver/commit/574266d">574266d</a>)</li>
<li><code class="docutils literal"><span class="pre">cqltypes</span></code> time/date functions removed, use <code class="docutils literal"><span class="pre">util</span></code> entry points instead (<a class="reference external" href="https://github.com/datastax/python-driver/commit/bb984ee">bb984ee</a>)</li>
<li><code class="docutils literal"><span class="pre">decoder</span></code> module removed (<a class="reference external" href="https://github.com/datastax/python-driver/commit/e16a073">e16a073</a>)</li>
<li><code class="docutils literal"><span class="pre">TableMetadata.keyspace</span></code> attribute replaced with <code class="docutils literal"><span class="pre">keyspace_name</span></code> (<a class="reference external" href="https://github.com/datastax/python-driver/commit/cc94073">cc94073</a>)</li>
<li><code class="docutils literal"><span class="pre">cqlengine.columns.TimeUUID.from_datetime</span></code> removed, use <code class="docutils literal"><span class="pre">util</span></code> variant instead (<a class="reference external" href="https://github.com/datastax/python-driver/commit/96489cc">96489cc</a>)</li>
<li><code class="docutils literal"><span class="pre">cqlengine.columns.Float(double_precision)</span></code> parameter removed, use <code class="docutils literal"><span class="pre">columns.Double</span></code> instead (<a class="reference external" href="https://github.com/datastax/python-driver/commit/a2d3a98">a2d3a98</a>)</li>
<li><code class="docutils literal"><span class="pre">cqlengine</span></code> keyspace management functions are removed in favor of the strategy-specific entry points (<a class="reference external" href="https://github.com/datastax/python-driver/commit/4bd5909">4bd5909</a>)</li>
<li><code class="docutils literal"><span class="pre">cqlengine.Model.__polymorphic_*__</span></code> attributes removed, use <code class="docutils literal"><span class="pre">__discriminator*</span></code> attributes instead (<a class="reference external" href="https://github.com/datastax/python-driver/commit/9d98c8e">9d98c8e</a>)</li>
<li><code class="docutils literal"><span class="pre">cqlengine.statements</span></code> will no longer warn about list list prepend behavior (<a class="reference external" href="https://github.com/datastax/python-driver/commit/79efe97">79efe97</a>)</li>
</ul>
</div>
</div>
<div class="section" id="upgrading-to-2-1-from-2-0">
<h2>Upgrading to 2.1 from 2.0<a class="headerlink" href="#upgrading-to-2-1-from-2-0" title="Permalink to this headline">¶</a></h2>
<p>Version 2.1 of the DataStax Python driver for Apache Cassandra
adds support for Cassandra 2.1 and version 3 of the native protocol.</p>
<p>Cassandra 1.2, 2.0, and 2.1 are all supported.  However, 1.2 only
supports protocol version 1, and 2.0 only supports versions 1 and
2, so some features may not be available.</p>
<div class="section" id="using-the-v3-native-protocol">
<h3>Using the v3 Native Protocol<a class="headerlink" href="#using-the-v3-native-protocol" title="Permalink to this headline">¶</a></h3>
<p>By default, the driver will attempt to use version 2 of the
native protocol.  To use version 3, you must explicitly
set the <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Cluster.protocol_version" title="cassandra.cluster.Cluster.protocol_version"><code class="xref py py-attr docutils literal"><span class="pre">protocol_version</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cassandra.cluster</span> <span class="kn">import</span> <span class="n">Cluster</span>

<span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="n">protocol_version</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that protocol version 3 is only supported by Cassandra 2.1+.</p>
<p>In future releases, the driver may default to using protocol version
3.</p>
</div>
<div class="section" id="working-with-user-defined-types">
<h3>Working with User-Defined Types<a class="headerlink" href="#working-with-user-defined-types" title="Permalink to this headline">¶</a></h3>
<p>Cassandra 2.1 introduced the ability to define new types:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">USE</span> <span class="n">KEYSPACE</span> <span class="n">mykeyspace</span><span class="p">;</span>

<span class="n">CREATE</span> <span class="n">TYPE</span> <span class="n">address</span> <span class="p">(</span><span class="n">street</span> <span class="n">text</span><span class="p">,</span> <span class="n">city</span> <span class="n">text</span><span class="p">,</span> <span class="nb">zip</span> <span class="nb">int</span><span class="p">);</span>
</pre></div>
</div>
<p>The driver generally expects you to use instances of a specific
class to represent column values of this type.  You can let the
driver know what class to use with <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Cluster.register_user_type" title="cassandra.cluster.Cluster.register_user_type"><code class="xref py py-meth docutils literal"><span class="pre">Cluster.register_user_type()</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Address</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">street</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">zipcode</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">street</span> <span class="o">=</span> <span class="n">street</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zipcode</span> <span class="o">=</span> <span class="n">zipcode</span>

<span class="n">cluster</span><span class="o">.</span><span class="n">register_user_type</span><span class="p">(</span><span class="s1">&#39;mykeyspace&#39;</span><span class="p">,</span> <span class="s1">&#39;address&#39;</span><span class="p">,</span> <span class="n">Address</span><span class="p">)</span>
</pre></div>
</div>
<p>When inserting data for <code class="docutils literal"><span class="pre">address</span></code> columns, you should pass in
instances of <code class="docutils literal"><span class="pre">Address</span></code>.  When querying data, <code class="docutils literal"><span class="pre">address</span></code> column
values will be instances of <code class="docutils literal"><span class="pre">Address</span></code>.</p>
<p>If no class is registered for a user-defined type, query results
will use a <code class="docutils literal"><span class="pre">namedtuple</span></code> class and data may only be inserted
though prepared statements.</p>
<p>See <a class="reference internal" href="user_defined_types.html#udts"><span class="std std-ref">User Defined Types</span></a> for more details.</p>
</div>
<div class="section" id="customizing-encoders-for-non-prepared-statements">
<h3>Customizing Encoders for Non-prepared Statements<a class="headerlink" href="#customizing-encoders-for-non-prepared-statements" title="Permalink to this headline">¶</a></h3>
<p>Starting with version 2.1 of the driver, it is possible to customize
how Python types are converted to CQL literals when working with
non-prepared statements.  This is done on a per-<a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Session" title="cassandra.cluster.Session"><code class="xref py py-class docutils literal"><span class="pre">Session</span></code></a>
basis through <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Session.encoder" title="cassandra.cluster.Session.encoder"><code class="xref py py-attr docutils literal"><span class="pre">Session.encoder</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">()</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">session</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">cql_encode_tuple</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="getting_started.html#type-conversions"><span class="std std-ref">Type Conversions</span></a> for the table of default CQL literal conversions.</p>
</div>
<div class="section" id="using-client-side-protocol-level-timestamps">
<h3>Using Client-Side Protocol-Level Timestamps<a class="headerlink" href="#using-client-side-protocol-level-timestamps" title="Permalink to this headline">¶</a></h3>
<p>With version 3 of the native protocol, timestamps may be supplied by the
client at the protocol level.  (Normally, if they are not specified within
the CQL query itself, a timestamp is generated server-side.)</p>
<p>When <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Cluster.protocol_version" title="cassandra.cluster.Cluster.protocol_version"><code class="xref py py-attr docutils literal"><span class="pre">protocol_version</span></code></a> is set to 3 or higher, the driver
will automatically use client-side timestamps with microsecond precision
unless <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Session.use_client_timestamp" title="cassandra.cluster.Session.use_client_timestamp"><code class="xref py py-attr docutils literal"><span class="pre">Session.use_client_timestamp</span></code></a> is changed to <code class="xref py py-const docutils literal"><span class="pre">False</span></code>.
If a timestamp is specified within the CQL query, it will override the
timestamp generated by the driver.</p>
</div>
</div>
<div class="section" id="upgrading-to-2-0-from-1-x">
<h2>Upgrading to 2.0 from 1.x<a class="headerlink" href="#upgrading-to-2-0-from-1-x" title="Permalink to this headline">¶</a></h2>
<p>Version 2.0 of the DataStax Python driver for Apache Cassandra
includes some notable improvements over version 1.x.  This version
of the driver supports Cassandra 1.2, 2.0, and 2.1.  However, not
all features may be used with Cassandra 1.2, and some new features
in 2.1 are not yet supported.</p>
<div class="section" id="using-the-v2-native-protocol">
<h3>Using the v2 Native Protocol<a class="headerlink" href="#using-the-v2-native-protocol" title="Permalink to this headline">¶</a></h3>
<p>By default, the driver will attempt to use version 2 of Cassandra&#8217;s
native protocol. You can explicitly set the protocol version to
2, though:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cassandra.cluster</span> <span class="kn">import</span> <span class="n">Cluster</span>

<span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="n">protocol_version</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>When working with Cassandra 1.2, you will need to
explicitly set the <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Cluster.protocol_version" title="cassandra.cluster.Cluster.protocol_version"><code class="xref py py-attr docutils literal"><span class="pre">protocol_version</span></code></a> to 1:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cassandra.cluster</span> <span class="kn">import</span> <span class="n">Cluster</span>

<span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="n">protocol_version</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="automatic-query-paging">
<h3>Automatic Query Paging<a class="headerlink" href="#automatic-query-paging" title="Permalink to this headline">¶</a></h3>
<p>Version 2 of the native protocol adds support for automatic query
paging, which can make dealing with large result sets much simpler.</p>
<p>See <a class="reference internal" href="query_paging.html#query-paging"><span class="std std-ref">Paging Large Queries</span></a> for full details.</p>
</div>
<div class="section" id="protocol-level-batch-statements">
<h3>Protocol-Level Batch Statements<a class="headerlink" href="#protocol-level-batch-statements" title="Permalink to this headline">¶</a></h3>
<p>With version 1 of the native protocol, batching of statements required
using a <a class="reference external" href="http://cassandra.apache.org/doc/cql3/CQL-3.0.html#batchStmt">BATCH cql query</a>.
With version 2 of the native protocol, you can now batch statements at
the protocol level. This allows you to use many different prepared
statements within a single batch.</p>
<p>See <a class="reference internal" href="api/cassandra/query.html#cassandra.query.BatchStatement" title="cassandra.query.BatchStatement"><code class="xref py py-class docutils literal"><span class="pre">BatchStatement</span></code></a> for details and usage examples.</p>
</div>
<div class="section" id="sasl-based-authentication">
<h3>SASL-based Authentication<a class="headerlink" href="#sasl-based-authentication" title="Permalink to this headline">¶</a></h3>
<p>Also new in version 2 of the native protocol is SASL-based authentication.
See the section on <a class="reference internal" href="security.html#security"><span class="std std-ref">Security</span></a> for details and examples.</p>
</div>
<div class="section" id="lightweight-transactions">
<h3>Lightweight Transactions<a class="headerlink" href="#lightweight-transactions" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.datastax.com/dev/blog/lightweight-transactions-in-cassandra-2-0">Lightweight transactions</a> are another new feature.  To use lightweight transactions, add <code class="docutils literal"><span class="pre">IF</span></code> clauses
to your CQL queries and set the <a class="reference internal" href="api/cassandra/query.html#cassandra.query.Statement.serial_consistency_level" title="cassandra.query.Statement.serial_consistency_level"><code class="xref py py-attr docutils literal"><span class="pre">serial_consistency_level</span></code></a>
on your statements.</p>
</div>
<div class="section" id="calling-cluster-shutdown">
<h3>Calling Cluster.shutdown()<a class="headerlink" href="#calling-cluster-shutdown" title="Permalink to this headline">¶</a></h3>
<p>In order to fix some issues around garbage collection and unclean interpreter
shutdowns, version 2.0 of the driver requires you to call <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Cluster.shutdown" title="cassandra.cluster.Cluster.shutdown"><code class="xref py py-meth docutils literal"><span class="pre">Cluster.shutdown()</span></code></a>
on your <a class="reference internal" href="api/cassandra/cluster.html#cassandra.cluster.Cluster" title="cassandra.cluster.Cluster"><code class="xref py py-class docutils literal"><span class="pre">Cluster</span></code></a> objects when you are through with them.
This helps to guarantee a clean shutdown.</p>
</div>
<div class="section" id="deprecations">
<h3>Deprecations<a class="headerlink" href="#deprecations" title="Permalink to this headline">¶</a></h3>
<p>The following functions have moved from <code class="docutils literal"><span class="pre">cassandra.decoder</span></code> to <code class="docutils literal"><span class="pre">cassandra.query</span></code>.
The original functions have been left in place with a <code class="xref py py-exc docutils literal"><span class="pre">DeprecationWarning</span></code> for
now:</p>
<ul class="simple">
<li><a class="reference internal" href="api/cassandra/decoder.html#cassandra.decoder.tuple_factory" title="cassandra.decoder.tuple_factory"><code class="xref py py-attr docutils literal"><span class="pre">cassandra.decoder.tuple_factory</span></code></a> has moved to
<a class="reference internal" href="api/cassandra/query.html#cassandra.query.tuple_factory" title="cassandra.query.tuple_factory"><code class="xref py py-attr docutils literal"><span class="pre">cassandra.query.tuple_factory</span></code></a></li>
<li><a class="reference internal" href="api/cassandra/decoder.html#cassandra.decoder.named_tuple_factory" title="cassandra.decoder.named_tuple_factory"><code class="xref py py-attr docutils literal"><span class="pre">cassandra.decoder.named_tuple_factory</span></code></a> has moved to
<a class="reference internal" href="api/cassandra/query.html#cassandra.query.named_tuple_factory" title="cassandra.query.named_tuple_factory"><code class="xref py py-attr docutils literal"><span class="pre">cassandra.query.named_tuple_factory</span></code></a></li>
<li><a class="reference internal" href="api/cassandra/decoder.html#cassandra.decoder.dict_factory" title="cassandra.decoder.dict_factory"><code class="xref py py-attr docutils literal"><span class="pre">cassandra.decoder.dict_factory</span></code></a> has moved to
<a class="reference internal" href="api/cassandra/query.html#cassandra.query.dict_factory" title="cassandra.query.dict_factory"><code class="xref py py-attr docutils literal"><span class="pre">cassandra.query.dict_factory</span></code></a></li>
<li><a class="reference internal" href="api/cassandra/decoder.html#cassandra.decoder.ordered_dict_factory" title="cassandra.decoder.ordered_dict_factory"><code class="xref py py-attr docutils literal"><span class="pre">cassandra.decoder.ordered_dict_factory</span></code></a> has moved to
<a class="reference internal" href="api/cassandra/query.html#cassandra.query.ordered_dict_factory" title="cassandra.query.ordered_dict_factory"><code class="xref py py-attr docutils literal"><span class="pre">cassandra.query.ordered_dict_factory</span></code></a></li>
</ul>
</div>
<div class="section" id="dependency-changes">
<h3>Dependency Changes<a class="headerlink" href="#dependency-changes" title="Permalink to this headline">¶</a></h3>
<p>The following dependencies have officially been made optional:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">scales</span></code></li>
<li><code class="docutils literal"><span class="pre">blist</span></code></li>
</ul>
<p>And one new dependency has been added (to enable Python 3 support):</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">six</span></code></li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="execution_profiles.html" title="Execution Profiles (experimental)"
             >next</a> |</li>
        <li class="right" >
          <a href="getting_started.html" title="Getting Started"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Cassandra Driver 3.10 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2013-2017 DataStax.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.3.
    </div>
  </body>
</html>